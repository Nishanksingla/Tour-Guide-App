<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=0">

    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>

    <script src="js/jquery-1.11.0.min.js"></script>
    <script src="js/jquery.mobile-1.4.2.min.js"></script>
    <script src="js/jquery.swipebox.min.js"></script>

    <link rel="stylesheet" href="css/jquery.mobile-1.4.2.min.css" />
    <link rel="stylesheet" href="css/swipebox.min.css" />

    <title>Tour App</title>
    <script type="text/javascript">
        $(function () {

            $('.swipebox').swipebox();

            $('.ui-grid-a a').click(function () {
                debugger
                if ($(this).attr('data-place') === 'TajMahal') {
                    sessionStorage.panoid = 'rEQIKH3RXo4AAAGusnEkNQ';
                    sessionStorage.place = 'Taj Mahal, Agra India';
                } else if ($(this).attr('data-place') === 'LotusTemple') {
                    sessionStorage.panoid = 'WdBZGlAP9jwAAAGu41fwjQ';
                    sessionStorage.place = 'Lotus Temple, New Delhi India';
                } else if ($(this).attr('data-place') === 'QutubMinar') {
                    sessionStorage.panoid = 'qGe1pZh1hMYAAAAGOoSngA';
                    sessionStorage.place = 'Qutub Minar, New Delhi India';
                } else if ($(this).attr('data-place') === 'JamaMasjid') {
                    sessionStorage.panoid = 'jtGqAJ9PkhcAAAAGOr7mCQ';
                    sessionStorage.place = 'Jama Masjid, New Delhi India';
                } else if ($(this).attr('data-place') === 'HumayunTomb') {
                    sessionStorage.panoid = 'Px7UKtIDgh4AAAQDMaGfRQ';
                    sessionStorage.place = 'Humayun Tomb, New Delhi India';
                }
            });

            $(document).on("pageshow", "#StreetView", function () {
                debugger
                $(this).find('[data-role="main"]').height($(window).height() - $(this).find('[data-role="footer"]').height());
                panoramaOptions.pano = sessionStorage.panoid;
                panorama.setPano(sessionStorage.panoid);
                panorama.setVisible(true);
            });

            $(document).on("pageshow", "#Directions", function () {
                if (directionsDisplay != null) {
                    $('#map-canvas').html('');
                    directionsDisplay.setMap(null);
                    directionsDisplay = null;
                }
                $(this).find('[data-role="main"]').height($(window).height() - $(this).find('[data-role="footer"]').height());
                $('#logMessages').html('');

                $('#logMessages').append('<label>Directions page shown</label></br>');

                if (navigator.geolocation) {
                    $('#logMessages').append('<label>navigator.geolocation is supported</label></br>');
                    navigator.geolocation.getCurrentPosition(onSuccess, onError, { enableHighAccuracy: true });
                } else {
                    $('#logMessages').append('navigator.geolocation not supported</label></br>');
                }
            });

            $(document).on("swipeleft swiperight", "#main", function (e) {
                alert('finger swiped');
                if ($(".ui-page-active").jqmData("panel") !== "open") {
                    alert('panel is closed');
                    if (e.type === "swiperight") {
                        alert('opening panel');
                        $("#revealPanel").panel("open");
                    }
                }
            });

            $("#loginPopup").on({
                popupbeforeposition: function () {
                    var h = $(window).height() - 150;
                    var w = $(window).width() - 100;
                    $("#loginPopup").css("height", h);
                    $("#loginPopup").css("width", w);
                }
            });

            $("#ReviewPopup").on({
                popupbeforeposition: function () {
                    var w = $(window).width() - 100;
                    $("#ReviewPopup").css("width", w);
                }
            });

            var onSuccess = function (position) {

                $('#logMessages').append('<label>latitude: ' + position.coords.latitude + '</label></br>');
                $('#logMessages').append('<label>longitude: ' + position.coords.longitude + '</label></br>');

                directionsDisplay = new google.maps.DirectionsRenderer();

                var startPosition = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);

                $('#logMessages').append('<label>startPosition: ' + startPosition + '</label></br>');

                var mapOptions = {
                    zoom: 7,
                    center: startPosition
                };

                map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

                directionsDisplay.setMap(map);
                var request = {
                    origin: startPosition,
                    destination: sessionStorage.place,
                    travelMode: google.maps.TravelMode.DRIVING
                };
                directionsService.route(request, function (response, status) {
                    if (status === google.maps.DirectionsStatus.OK) {
                        directionsDisplay.setDirections(response);
                    } else {
                        alert('Error getting route');
                    }
                });
            };

            function onError(error) {
                alert('code: ' + error.code + '\n' +
                      'message: ' + error.message + '\n');
                $('#logMessages').append('<label>Error getting current position' + error.code + error.message + '</label></br>');
            }

            var directionsDisplay;
            var directionsService = new google.maps.DirectionsService();
            var map;

            var panoramaOptions = {
                pano: 'rEQIKH3RXo4AAAGusnEkNQ',
                pov: {
                    heading: 360,
                    pitch: 10
                }
            };

            var panorama = new google.maps.StreetViewPanorama(document.getElementById('pano'), panoramaOptions);

        });

    </script>

    <style>
        #main { position: relative; }
        #loading {
            opacity: .8;
            background: url("images/ajax-loader.gif") no-repeat center;
            cursor: auto;
            width: 100%;
            height: 100%;
            z-index: 200000;
            position: fixed;            
            top: 0;
            left:0;
            background-color: lightgrey;            
        }
        .fbButton {
            width:200px !important;
            padding:0 !important;
            height:40px !important;
            border-radius:0 0 !important;
            background:url(images/facebook.png) no-repeat center;
            height:100%;
            background-color:transparent !important;
            border:none;
            box-shadow:none;
            display:block;
            margin:0 auto
        }
        .ui-popup-screen {
            background-color:gray;
        }
        #map-canvas {
            background: transparent url(images/ajax-loading.gif) no-repeat center center;
        }
        .box {
            list-style-type: none;
            float: left;
            margin: 10px 10px;
        }

        .ui-block-a, .ui-block-b {
            text-align: center;
            padding: 10px;
            margin-bottom: 20px;
        }

        .ui-grid-a img {
            width: 100%;
            height: 100%;
        }

        /* Smartphones (portrait and landscape) ----------- */

        @media only screen and (min-device-width : 320px) and (orientation : portrait) {
            .ui-block-a, .ui-block-b {
                height: 120px;
            }
        }
        @media only screen and (min-device-width : 320px) and (orientation : landscape) {
            .ui-block-a, .ui-block-b {
                height: 180px;
            }
        }

        /* iPads (portrait and landscape) ----------- */
        @media only screen and (min-device-width : 768px) and (max-device-width : 1024px) {
            .ui-block-a, .ui-block-b {
                height: 250px;
            }
        }

        /* Desktops and laptops ----------- */
        @media only screen and (min-width : 1224px) {
            .ui-block-a, .ui-block-b {
                height: 350px;
            }
        }

        /* Large screens ----------- */
        @media only screen and (min-width : 1824px) {
            .ui-block-a, .ui-block-b {
                height: 350px;
            }
        }
    </style>
</head>
<body>
    <div data-role="page" id="main">
        <div id="loading"></div>
        <div data-role="panel" id="revealPanel" data-display="reveal">
            <!--<a href="#main" data-rel="close" class="ui-btn ui-btn-inline ui-shadow ui-corner-all ui-btn-a ui-icon-power ui-btn-icon-left">Close panel</a>-->
            <div style="text-align:center;text-shadow:none">
                <img id="FBprofileimage" style="border-radius: 50%;height:100px" />
                <label id="FBusername" style="font-size:1.2em"></label>
                <label id="email" style="font-size: .8em;"></label>
            </div>
            <div style="padding: 10px;border-top: 1px solid lightgrey;border-bottom: 1px solid lightgray;">
                <a href="#main" style="position: relative;text-decoration:none" class="ui-btn-icon-left ui-icon-power" onclick="logout()">Log Out</a>
            </div>
        </div>

        <div data-role="header" data-position="fixed" style="background-color:skyblue;color:white;text-shadow:none;">
            <a href="#loginPopup" id="loginButton" data-rel="popup" class="ui-btn ui-btn-left ui-btn-inline ui-corner-all ui-btn-icon-left ui-icon-user" data-position-to="window">Login</a>
            <a href="#revealPanel" class="ui-nodisc-icon ui-link ui-btn-left ui-btn ui-icon-bars ui-btn-icon-notext" style="background-color:transparent;border:0;display:none"></a>

            <h1>New Delhi</h1>
            <a href="#" class="ui-btn ui-btn-right ui-corner-all ui-shadow ui-icon-search ui-btn-icon-left">Search</a>
        </div>

        <div data-role="main" class="ui-content" style="min-height:inherit" id="MainPageContent">
            <div class="ui-grid-a">
                <div class="ui-block-a">
                    <a href="#Options" data-place="LotusTemple">
                        <img src="images/LotusTemple.jpg" class="ui-corner-all ui-shadow" />
                        <figcaption style="text-align: center">Lotus Temple</figcaption>
                    </a>
                </div>
                <div class="ui-block-b">
                    <a href="#Options" data-place="QutubMinar">
                        <img src="images/QutubMinar.jpg" class="ui-corner-all ui-shadow" />
                        <figcaption style="text-align: center">Qutub Minar</figcaption>
                    </a>
                </div>
                <div class="ui-block-a">
                    <a href="#Options" data-place="JamaMasjid">
                        <img src="images/JamaMasjid.jpg" class="ui-corner-all ui-shadow" />
                        <figcaption style="text-align: center">Jama Masjid</figcaption>
                    </a>
                </div>
                <div class="ui-block-b">
                    <a href="#Options" data-place="HumayunTomb">
                        <img src="images/HumayunTomb.jpg" class="ui-corner-all ui-shadow" />
                        <figcaption style="text-align: center">Humayun Tomb</figcaption>
                    </a>
                </div>
            </div>

            <div data-role="popup" id="loginPopup" class="ui-content">
                <a href="#main" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn ui-btn-b ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a>
                <!--<h2 style="text-align:center">Login With Facebook</h2>-->
                <div style="text-align:center;width:100%">
                    <button class="fbButton" onclick="fbLogin()"></button>
                </div>
                <!--<div style="width:100%;text-align:center;margin-top:2%" class="fb-login-button" data-max-rows="1" data-size="large" data-show-faces="false" data-auto-logout-link="true" data-scope="public_profile,email" onlogin="getUserInfo();"></div>-->
                <div id="fb-root"></div>
            </div>
        </div>
    </div>

    <div data-role="page" id="Options">
        <div data-role="header" data-position="fixed">
            <label style="text-align:center;font-size: 1.8em;margin: .2em 0;">Options</label>
        </div>
        <div data-role="main" class="ui-content">
            <div id="menu">
                <ul data-role="listview">
                    <li><a href="#StreetView">Virtual Tour</a></li>
                    <li><a href="#imageGallery">Image Gallery</a></li>
                    <li><a href="#Information">General Information</a></li>
                    <li><a href="#Directions">Directions</a></li>
                    <li><a href="#Reviews">Reviews</a></li>
                    <!--<li><a href="#">Add this place</a></li>-->
                </ul>
            </div>

        </div>
        <div data-role="footer" data-position="fixed">
            <a href="#main" class="ui-btn ui-corner-all ui-shadow ui-btn-icon-left ui-icon-back ui-btn-icon-left">Back</a>
        </div>
    </div>

    <div data-role="page" id="StreetView">
        <div data-role="main">
            <div id="pano" style="height:100%">
            </div>
        </div>
        <div data-role="footer" data-position="fixed">
            <a href="#Options" class="ui-btn ui-corner-all ui-shadow ui-btn-icon-left ui-icon-back ui-btn-icon-left" data-transition="slide" data-direction="reverse">Back</a>
        </div>
    </div>

    <div data-role="page" id="Information">
        <div data-role="main">
            <p></p>
        </div>
        <div data-role="footer" data-position="fixed">
            <a href="#Options" class="ui-btn ui-corner-all ui-shadow ui-btn-icon-left ui-icon-back ui-btn-icon-left" data-transition="slide" data-direction="reverse">Back</a>
        </div>
    </div>

    <div data-role="page" id="imageGallery">
        <div data-role="main" class="ui-content">
            <ul style="margin: 0; padding: 0">
                <li class="box">
                    <a href="images/tajmahal1.jpg" class="swipebox" title="Taj Mahal 1">
                        <img src="images/tajmahal1.jpg" style="width: 100%;" />
                    </a>
                </li>
                <li class="box">
                    <a href="images/tajmahal2.jpg" class="swipebox" title="Taj Mahal 2">
                        <img src="images/tajmahal2.jpg" style="width: 100%;" />
                    </a>
                </li>
                <li class="box">
                    <a href="images/tajmahal3.jpg" class="swipebox" title="Taj Mahal 3">
                        <img src="images/tajmahal3.jpg" style="width: 100%;" />
                    </a>
                </li>
                <li class="box">
                    <a href="images/tajmahal4.jpg" class="swipebox" title="Taj Mahal 4">
                        <img src="images/tajmahal4.jpg" style="width: 100%;" />
                    </a>
                </li>
            </ul>
        </div>
        <div data-role="footer" data-position="fixed">
            <a href="#Options" class="ui-btn ui-corner-all ui-shadow ui-btn-icon-left ui-icon-back ui-btn-icon-left" data-transition="slide" data-direction="reverse">Back</a>
        </div>
    </div>

    <div data-role="page" id="Directions">
        <div data-role="main" style="min-height: inherit">
            <!--<div id="logMessages" style="overflow-x: auto; height: 25vw; border: 1px solid black;"></div>-->
            <div id="map-canvas" style="height:100%"></div>
        </div>
        <div data-role="footer" data-position="fixed">
            <a href="#Options" class="ui-btn ui-corner-all ui-shadow ui-btn-icon-left ui-icon-back ui-btn-icon-left">Back</a>
        </div>
    </div>

    <div data-role="page" id="Reviews">
        <div data-role="header" data-position="fixed">
            <h1>Reviews</h1>
            <a href="#ReviewPopup" id="ReviewButton" data-rel="popup" class="ui-btn ui-btn-right ui-btn-inline ui-corner-all ui-btn-icon-left ui-icon-plus" data-position-to="window">Add Review</a>
        </div>
        <div data-role="main">

        </div>

        <div data-role="popup" id="ReviewPopup" class="ui-content">
            <a href="#Reviews" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn ui-btn-b ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a>
            <h2 style="text-align: center;">Add Review</h2>
            <div>
                <form method="post">
                    <div class="ui-field-contain">
                        <label for="Rating">Rating:</label>
                        <select name="Rating" id="Rating">
                            <option value="select">--Select--</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>
                    <div class="ui-field-contain">
                        <label for="Descritpion">Descritpion:</label>
                        <textarea name="Descritpion" id="Descritpion"></textarea>
                    </div>
                    <input type="submit" data-inline="true" value="Submit">
                </form>
            </div>
        </div>
        <div data-role="footer" data-position="fixed">
            <a href="#Options" class="ui-btn ui-corner-all ui-shadow ui-btn-icon-left ui-icon-back ui-btn-icon-left" data-transition="slide" data-direction="reverse">Back</a>
        </div>
    </div>

    <!-- cordova -->
    <script src="cordova.js"></script>
    <!-- cordova facebook plugin -->
    <script src="cdv-plugin-fb-connect.js"></script>
    <!-- facebook js sdk -->
    <script src="facebook-js-sdk.js"></script>

    <script>

        if ((typeof cordova == 'undefined') && (typeof Cordova == 'undefined')) alert('Cordova variable does not exist. Check that you have included cordova.js correctly');
        if (typeof CDV == 'undefined') alert('CDV variable does not exist. Check that you have included cdv-plugin-fb-connect.js correctly');
        if (typeof FB == 'undefined') alert('FB variable does not exist. Check that you have included the Facebook JS SDK file.');

        function fbLogin() {
            FB.login(function (response) {
                if (response.status === 'connected') {
                    $('#loading').show();
                    getUserInfo();
                }
            }, { scope: 'public_profile,email' });
        }

        function getUserInfo() {
            FB.api('/me', function (response) {
                $('#FBusername').val(response.first_name);
                $('#FBusername').text(response.first_name);
                $('#email').text(response.email);
            });
            FB.api('/me/picture', { "type": "large" }, function (response) {
                $('#FBprofileimage').attr('src', response.data.url);
                $('a[href="#revealPanel"]').show();
                $('a[href="#loginPopup"]').hide();                
                if ($('#loginPopup').parent().hasClass('ui-popup-active')) {
                    console.log('Pop Up is open');                    
                    $('#loginPopup-popup').removeClass('ui-popup-active').addClass('ui-popup-hidden');
                    $('#loginPopup-screen').addClass('ui-screen-hidden');
                    $('#loginPopup').popup("close");
                }
                $('#loading').hide();
            });
        }

        function logout() {
            console.log('facebook logout');
            $('#loading').show();
            $('#loading').css('display', 'block');
            //$('#loading').css('visibility', 'visible');
            console.log('Loading show');

            FB.logout(function (response) {
                $('a[href="#loginPopup"]').show();
                $('a[href="#revealPanel"]').hide();

                $('#revealPanel').panel("close");

                $('#loading').hide();
                $('#loading').css('display', 'none');
            });
        }

        document.addEventListener('deviceready', function () {
            try {                
                console.log('Device is ready! Make sure you set your app_id below this alert.');
                document.getElementById('MainPageContent').style.minHeight = 'inherit';
                FB.init({
                    appId: '924651857553242',
                    nativeInterface: CDV.FB,
                    useCachedDialogs: false,
                    cookie: true,
                    xfbml: true,
                    version: 'v2.1'
                });
                FB.getLoginStatus(function (response) {
                    if (response.status === "connected") {
                        getUserInfo();
                    }
                    $('#loading').hide();
                });
            } catch (e) {
                alert(e);
            }
        }, false);
    </script>
</body>
</html>
